<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uTrack: uTrack/Hardware/2387/utI2S_2387.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">uTrack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a4e24aea86a0dbe5a7267615eff7c74c.html">uTrack</a></li><li class="navelem"><a class="el" href="dir_651d4167e96b853638964b7435747bb1.html">Hardware</a></li><li class="navelem"><a class="el" href="dir_2d94069f915ea8f76d266fe4e650b5f1.html">2387</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">utI2S_2387.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="ut_i2_s__2387_8c.html" title="utI2S_2387.c handles reading and writing audio to and from the I2S bus connected to the Bluetooth har...">utI2S_2387.c</a> handles reading and writing audio to and from the I2S bus connected to the Bluetooth hardware module on the LPC2387, as well as writing recorded audio to a file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;LPC23xx.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;pcm.h&gt;</code><br />
<code>#include &quot;utHAL.h&quot;</code><br />
<code>#include &quot;utI2S_2387.h&quot;</code><br />
<code>#include &quot;utI2S_2387Lowlevel.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab66fe69b324ccf6f854a64423b124b39"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#ab66fe69b324ccf6f854a64423b124b39">MULTIBYTE_IRQ</a></td></tr>
<tr class="separator:ab66fe69b324ccf6f854a64423b124b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82117abf48fef99562b7dc087c79bb5c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a82117abf48fef99562b7dc087c79bb5c">LMASK</a>&#160;&#160;&#160;0xFFFF0000</td></tr>
<tr class="separator:a82117abf48fef99562b7dc087c79bb5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab313966344db7ce2681d95597427a7b4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#ab313966344db7ce2681d95597427a7b4">RMASK</a>&#160;&#160;&#160;0x0000FFFF</td></tr>
<tr class="separator:ab313966344db7ce2681d95597427a7b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f77a13b2beaed43fa72e36ed62889d3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a0f77a13b2beaed43fa72e36ed62889d3">LSHIFT</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a0f77a13b2beaed43fa72e36ed62889d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1049a0169e895645cf0ca72784a1ee13"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a1049a0169e895645cf0ca72784a1ee13">RSHIFT</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a1049a0169e895645cf0ca72784a1ee13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac374cd2759ffcea631b903bc5156683b"><td class="memItemLeft" align="right" valign="top"><a id="ac374cd2759ffcea631b903bc5156683b" name="ac374cd2759ffcea631b903bc5156683b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FIFO_RX_LVL</b>&#160;&#160;&#160;4</td></tr>
<tr class="memdesc:ac374cd2759ffcea631b903bc5156683b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The minimum number of samples needed in the I2S RX hardware FIFO before an interrupt is generated. It is only defined if <a class="el" href="ut_i2_s__2387_8c.html#ab66fe69b324ccf6f854a64423b124b39">MULTIBYTE_IRQ</a> is defined, because otherwise an interrupt is generated whenever a sample is placed in the FIFO. <br /></td></tr>
<tr class="separator:ac374cd2759ffcea631b903bc5156683b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac69ee46f4a51ed14f0d68628c2dec71d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#ac69ee46f4a51ed14f0d68628c2dec71d">MAX_CHANNELS</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ac69ee46f4a51ed14f0d68628c2dec71d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3db2d1aa6a0f0199c0b6e9dc7b04e9b2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a3db2d1aa6a0f0199c0b6e9dc7b04e9b2">DAY_MS</a>&#160;&#160;&#160;86400000</td></tr>
<tr class="separator:a3db2d1aa6a0f0199c0b6e9dc7b04e9b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adeadc28ca330d8e9d63fe19f4d46d226"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#adeadc28ca330d8e9d63fe19f4d46d226">GetNChannels</a> ()</td></tr>
<tr class="separator:adeadc28ca330d8e9d63fe19f4d46d226"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe9ceeb79dfd9cc6129d8df7e316b382"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#abe9ceeb79dfd9cc6129d8df7e316b382">utI2S2387_Powerup</a> (void)</td></tr>
<tr class="separator:abe9ceeb79dfd9cc6129d8df7e316b382"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4c2225facfc114257ee5a9c20e383c7"><td class="memItemLeft" align="right" valign="top">__irq void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#ab4c2225facfc114257ee5a9c20e383c7">utI2S2387_IRQHandler</a> (void)</td></tr>
<tr class="separator:ab4c2225facfc114257ee5a9c20e383c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75759133d679241e00e9b3fce6b1b550"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a75759133d679241e00e9b3fce6b1b550">utI2S2387_Start</a> (void)</td></tr>
<tr class="separator:a75759133d679241e00e9b3fce6b1b550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59cd1b7dce175dcfe40baed5822bef60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a59cd1b7dce175dcfe40baed5822bef60">utI2S2387_Stop</a> (void)</td></tr>
<tr class="separator:a59cd1b7dce175dcfe40baed5822bef60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6305f7e777ccfcd5dda660fd987af2ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a6305f7e777ccfcd5dda660fd987af2ad">utI2S2387_EndRecording</a> (void)</td></tr>
<tr class="separator:a6305f7e777ccfcd5dda660fd987af2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1af9ad9c5ed5752ace6138f10255419"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#af1af9ad9c5ed5752ace6138f10255419">utI2S2387_AddDeviceAddress</a> (const char *btAddress, bool isFirstDevice)</td></tr>
<tr class="memdesc:af1af9ad9c5ed5752ace6138f10255419"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a Bluetooth device ID to the current metadata tags. Currently a maximum of two device IDs is supported.  <br /></td></tr>
<tr class="separator:af1af9ad9c5ed5752ace6138f10255419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef499415ae319bc2464c7f2c4484b2cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#aef499415ae319bc2464c7f2c4484b2cf">utI2S2387_BeginRecording</a> (const char *filename, UT_DateTime timestamp, bool isGPSTime, const char *serial, const char *btAddress, int recordingSession, int useChannels)</td></tr>
<tr class="memdesc:aef499415ae319bc2464c7f2c4484b2cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start recording audio to a file, with a set of metadata to append when recording is stopped.  <br /></td></tr>
<tr class="separator:aef499415ae319bc2464c7f2c4484b2cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1d5cf8d4b4a04d614fdf2c9a8dab19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#adb1d5cf8d4b4a04d614fdf2c9a8dab19">utI2S2387_UpdateToGPSTime</a> (UT_DateTime timestamp)</td></tr>
<tr class="memdesc:adb1d5cf8d4b4a04d614fdf2c9a8dab19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjusts the starting timestamp in the audio metadata according to the current time, provided the starting timestamp was not valid GPS time. It is assumed that the current <em>timestamp</em> is valid GPS time, because otherwise calling this function is not helpful. It operates by calculating the time since the audio recording started using the audio sample rate and quantity of recorded data. It does not allow for leap-seconds in the period between the starting time and the current time.  <br /></td></tr>
<tr class="separator:adb1d5cf8d4b4a04d614fdf2c9a8dab19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fdcea5067c288746fe08252c463dd1b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#a0fdcea5067c288746fe08252c463dd1b">utI2S2387_Update</a> (void)</td></tr>
<tr class="memdesc:a0fdcea5067c288746fe08252c463dd1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The step function for this module. This is where audio is written to file.  <br /></td></tr>
<tr class="separator:a0fdcea5067c288746fe08252c463dd1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae00a76e6292aab4bb934ce3a492fe55f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ut_i2_s__2387_8c.html#ae00a76e6292aab4bb934ce3a492fe55f">utI2S2387_EnableLoopback</a> (bool useLoopback, bool crossLink)</td></tr>
<tr class="separator:ae00a76e6292aab4bb934ce3a492fe55f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="ut_i2_s__2387_8c.html" title="utI2S_2387.c handles reading and writing audio to and from the I2S bus connected to the Bluetooth har...">utI2S_2387.c</a> handles reading and writing audio to and from the I2S bus connected to the Bluetooth hardware module on the LPC2387, as well as writing recorded audio to a file. </p>
<p>Note that the Bluetooth module sends two copies of one sample when only one 16-bit channel is in use, or two copies of two 8-bit samples when only one 8-bit channel is in use.</p>
<dl class="section author"><dt>Author</dt><dd>Oscar Key </dd></dl>
<dl class="section date"><dt>Date</dt><dd>15/01/2012 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012, Igtimi Ltd., all rights reserved.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd><p class="startdd">Function de-duplication. </p>
<p class="interdd">Reduce coupling. </p>
<p class="enddd">Generalise/abstract some overly specific functions. </p>
</dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3db2d1aa6a0f0199c0b6e9dc7b04e9b2" name="a3db2d1aa6a0f0199c0b6e9dc7b04e9b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db2d1aa6a0f0199c0b6e9dc7b04e9b2">&#9670;&#160;</a></span>DAY_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAY_MS&#160;&#160;&#160;86400000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The number of milliseconds in a day. </p>

</div>
</div>
<a id="a82117abf48fef99562b7dc087c79bb5c" name="a82117abf48fef99562b7dc087c79bb5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82117abf48fef99562b7dc087c79bb5c">&#9670;&#160;</a></span>LMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LMASK&#160;&#160;&#160;0xFFFF0000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The bitmask for the 16-bit left channel in the 32-bit I2S FIFO hardware buffer. </p>

</div>
</div>
<a id="a0f77a13b2beaed43fa72e36ed62889d3" name="a0f77a13b2beaed43fa72e36ed62889d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f77a13b2beaed43fa72e36ed62889d3">&#9670;&#160;</a></span>LSHIFT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSHIFT&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The number of places the left sample should be right shifted by to be stored in a 16-bit unsigned integer type. </p>

</div>
</div>
<a id="ac69ee46f4a51ed14f0d68628c2dec71d" name="ac69ee46f4a51ed14f0d68628c2dec71d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac69ee46f4a51ed14f0d68628c2dec71d">&#9670;&#160;</a></span>MAX_CHANNELS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CHANNELS&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The maximum number of audio channels the current software implementation supports. </p>

</div>
</div>
<a id="ab66fe69b324ccf6f854a64423b124b39" name="ab66fe69b324ccf6f854a64423b124b39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab66fe69b324ccf6f854a64423b124b39">&#9670;&#160;</a></span>MULTIBYTE_IRQ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MULTIBYTE_IRQ</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Whether or not to clear multiple bytes from the hardware FIFO per interrupt. </p>

</div>
</div>
<a id="ab313966344db7ce2681d95597427a7b4" name="ab313966344db7ce2681d95597427a7b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab313966344db7ce2681d95597427a7b4">&#9670;&#160;</a></span>RMASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RMASK&#160;&#160;&#160;0x0000FFFF</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The bitmask for the 16-bit rightchannel in the 32-bit I2S FIFO hardware buffer. </p>

</div>
</div>
<a id="a1049a0169e895645cf0ca72784a1ee13" name="a1049a0169e895645cf0ca72784a1ee13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1049a0169e895645cf0ca72784a1ee13">&#9670;&#160;</a></span>RSHIFT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RSHIFT&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The number of places the right sample should be right shifted by to be stored in a 16-bit unsigned integer type. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adeadc28ca330d8e9d63fe19f4d46d226" name="adeadc28ca330d8e9d63fe19f4d46d226"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adeadc28ca330d8e9d63fe19f4d46d226">&#9670;&#160;</a></span>GetNChannels()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GetNChannels </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>GetNChannels returns the number of channels being used, and is referred to by the wavpack system.</p>
<dl class="section return"><dt>Returns</dt><dd>The number of audio channels the system is operating with. </dd></dl>

</div>
</div>
<a id="af1af9ad9c5ed5752ace6138f10255419" name="af1af9ad9c5ed5752ace6138f10255419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1af9ad9c5ed5752ace6138f10255419">&#9670;&#160;</a></span>utI2S2387_AddDeviceAddress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_AddDeviceAddress </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>btAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isFirstDevice</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a Bluetooth device ID to the current metadata tags. Currently a maximum of two device IDs is supported. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">btAddress</td><td>The null-terminated device ID to add. </td></tr>
    <tr><td class="paramname">isFirstDevice</td><td>Whether this is the first or second device ID being added. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aef499415ae319bc2464c7f2c4484b2cf" name="aef499415ae319bc2464c7f2c4484b2cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef499415ae319bc2464c7f2c4484b2cf">&#9670;&#160;</a></span>utI2S2387_BeginRecording()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_BeginRecording </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UT_DateTime&#160;</td>
          <td class="paramname"><em>timestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isGPSTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>serial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>btAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>recordingSession</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>useChannels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start recording audio to a file, with a set of metadata to append when recording is stopped. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The filename to open and write to. Null-terminated. </td></tr>
    <tr><td class="paramname">timestamp</td><td>The timestamp to store in the metadata. May be updated by <a class="el" href="ut_i2_s__2387_8c.html#adb1d5cf8d4b4a04d614fdf2c9a8dab19">utI2S2387_UpdateToGPSTime</a>. </td></tr>
    <tr><td class="paramname">isGPSTime</td><td>Whether or not <em>timestamp</em> is the time according the GPS hardware module. </td></tr>
    <tr><td class="paramname">serial</td><td>The unit serial (bot ID). Null-terminated. </td></tr>
    <tr><td class="paramname">btAddress</td><td>The Bluetooth device ID of the device we are recording audio from. Null-terminated. </td></tr>
    <tr><td class="paramname">recordingSession</td><td>The recording session for this runtime stream. </td></tr>
    <tr><td class="paramname">useChannels</td><td>The number of channels expected over the I2S bus according to higher level logic. Current maximum of two.</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>Enforce argument limits. </dd></dl>

</div>
</div>
<a id="ae00a76e6292aab4bb934ce3a492fe55f" name="ae00a76e6292aab4bb934ce3a492fe55f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae00a76e6292aab4bb934ce3a492fe55f">&#9670;&#160;</a></span>utI2S2387_EnableLoopback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_EnableLoopback </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>useLoopback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>crossLink</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enables or disables the loopback capability, wherein audio received over the I2S bus can be transmitted back across it, so that the Bluetooth hardware sends it back to a headset. If two headsets are connected, the channels can be swapped, linking the two headsets together.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">useLoopback</td><td>Whether or not to send received audion data back over the I2S bus to the unit's Bluetooth hardware module. </td></tr>
    <tr><td class="paramname">crossLink</td><td>Whether or not to link headsets so they send to each other via the unit's Bluetooth module, provided there are two headsets. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6305f7e777ccfcd5dda660fd987af2ad" name="a6305f7e777ccfcd5dda660fd987af2ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6305f7e777ccfcd5dda660fd987af2ad">&#9670;&#160;</a></span>utI2S2387_EndRecording()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_EndRecording </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stops recording audio to the current file. </p>

</div>
</div>
<a id="ab4c2225facfc114257ee5a9c20e383c7" name="ab4c2225facfc114257ee5a9c20e383c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4c2225facfc114257ee5a9c20e383c7">&#9670;&#160;</a></span>utI2S2387_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__irq void utI2S2387_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The interrupt handler run when an interrupt is generated by the I2S RX hardware FIFO. </p>

</div>
</div>
<a id="abe9ceeb79dfd9cc6129d8df7e316b382" name="abe9ceeb79dfd9cc6129d8df7e316b382"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe9ceeb79dfd9cc6129d8df7e316b382">&#9670;&#160;</a></span>utI2S2387_Powerup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_Powerup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Dummy function for completeness and interface satisfaction. </p>

</div>
</div>
<a id="a75759133d679241e00e9b3fce6b1b550" name="a75759133d679241e00e9b3fce6b1b550"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75759133d679241e00e9b3fce6b1b550">&#9670;&#160;</a></span>utI2S2387_Start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_Start </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Carries out the necessary pin configuration for the I2S bus between the LPC2387 and the WT32 Bluetooth hardware module to function. </p>

</div>
</div>
<a id="a59cd1b7dce175dcfe40baed5822bef60" name="a59cd1b7dce175dcfe40baed5822bef60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59cd1b7dce175dcfe40baed5822bef60">&#9670;&#160;</a></span>utI2S2387_Stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_Stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unsets the necessary pins to avoid leakage. </p>

</div>
</div>
<a id="a0fdcea5067c288746fe08252c463dd1b" name="a0fdcea5067c288746fe08252c463dd1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fdcea5067c288746fe08252c463dd1b">&#9670;&#160;</a></span>utI2S2387_Update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool utI2S2387_Update </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The step function for this module. This is where audio is written to file. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns true if there were no errors, else false. </dd></dl>

</div>
</div>
<a id="adb1d5cf8d4b4a04d614fdf2c9a8dab19" name="adb1d5cf8d4b4a04d614fdf2c9a8dab19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb1d5cf8d4b4a04d614fdf2c9a8dab19">&#9670;&#160;</a></span>utI2S2387_UpdateToGPSTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void utI2S2387_UpdateToGPSTime </td>
          <td>(</td>
          <td class="paramtype">UT_DateTime&#160;</td>
          <td class="paramname"><em>timestamp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjusts the starting timestamp in the audio metadata according to the current time, provided the starting timestamp was not valid GPS time. It is assumed that the current <em>timestamp</em> is valid GPS time, because otherwise calling this function is not helpful. It operates by calculating the time since the audio recording started using the audio sample rate and quantity of recorded data. It does not allow for leap-seconds in the period between the starting time and the current time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timestamp</td><td>The current time according to GPS fix data. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 26 2024 13:41:58 for uTrack by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
